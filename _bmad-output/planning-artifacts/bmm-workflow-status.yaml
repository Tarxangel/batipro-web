# BMM Workflow Status - Batipro
# This tracks progress through BMM methodology Analysis, Planning, and Solutioning phases.
# Implementation phase is tracked separately in sprint-status.yaml

# STATUS DEFINITIONS:
# ==================
# Initial Status (before completion):
#   - required: Must be completed to progress
#   - optional: Can be completed but not required
#   - recommended: Strongly suggested but not required
#   - conditional: Required only if certain conditions met (e.g., if_has_ui)
#
# Completion Status:
#   - {file-path}: File created/found (e.g., "docs/product-brief.md")
#   - skipped: Optional/conditional workflow that was skipped

generated: "2026-01-19"
last_updated: "2026-01-20"
project: "Batipro"
project_type: "Plateforme web consultation PLU/RNU avec carte interactive + Module articles chantier"
selected_track: "bmad-method"
field_type: "brownfield"
workflow_path: "method-brownfield.yaml"

workflow_status:
  # Phase 0: Documentation (Prerequisite for brownfield)
  phase_0_documentation:
    document-project:
      status: required
      agent: analyst
      command: /bmad:bmm:workflows:document-project
      purpose: "Comprendre le codebase existant avant planification"

  # Phase 1: Analysis (Optional)
  phase_1_analysis:
    brainstorm:
      status: "_bmad-output/analysis/brainstorming-session-2026-01-13.md"
      note: "Session complète - 33 idées, 5 phases, stack validée"
    research:
      status: skipped
    product-brief:
      status: skipped

  # Phase 2: Planning
  phase_2_planning:
    prd:
      status: required
      agent: pm
      command: /bmad:bmm:workflows:prd
      purpose: "Product Requirements Document avec FRs et NFRs"
    create-ux-design:
      status: conditional
      condition: if_has_ui
      agent: ux-designer
      command: /bmad:bmm:workflows:create-ux-design
      note: "À déterminer après PRD - app web avec carte = probablement requis"

  # Phase 3: Solutioning
  phase_3_solutioning:
    create-architecture:
      status: required
      agent: architect
      command: /bmad:bmm:workflows:create-architecture
      purpose: "Document d'architecture système"
    create-epics-and-stories:
      status: required
      agent: pm
      command: /bmad:bmm:workflows:create-epics-and-stories
      purpose: "Décomposition PRD en epics et stories implémentables"
    test-design:
      status: optional
      agent: tea
      command: /bmad:bmm:workflows:testarch-test-design
      purpose: "Revue de testabilité au niveau système"
    implementation-readiness:
      status: required
      agent: architect
      command: /bmad:bmm:workflows:check-implementation-readiness
      purpose: "Validation PRD + Architecture + Epics + UX"

  # Phase 4: Implementation
  phase_4_implementation:
    sprint-planning:
      status: required
      agent: sm
      command: /bmad:bmm:workflows:sprint-planning
      purpose: "Création du plan de sprint - suivi détaillé ensuite"

# ============================================
# IMPLEMENTATION COMPLETED - Session 2026-01-20
# ============================================
completed_features:
  module_articles_chantier:
    description: "Module de génération et publication d'articles de chantier avec IA"
    status: "completed"
    date: "2026-01-20"

    components:
      frontend:
        - file: "web-app/articles.html"
          description: "Page principale du module articles"
        - file: "web-app/src/articles/main.ts"
          description: "Logique TypeScript - upload, génération, édition, publication"
        - file: "web-app/src/articles/api.ts"
          description: "Appels API vers n8n (génération + publication)"
        - file: "web-app/src/articles/database.ts"
          description: "Gestion brouillons Supabase (CRUD)"
        - file: "web-app/src/articles/config.ts"
          description: "URLs webhooks n8n"
        - file: "web-app/src/articles/styles.css"
          description: "Styles du module"

      supabase_functions:
        - file: "supabase/functions/n8n-proxy/index.ts"
          description: "Proxy CORS pour webhook génération n8n"
          endpoint: "https://awhbjbuxbcxszlxcbpjb.supabase.co/functions/v1/n8n-proxy"
        - file: "supabase/functions/smart-endpoint/index.ts"
          description: "Proxy CORS pour webhook publication n8n"
          endpoint: "https://awhbjbuxbcxszlxcbpjb.supabase.co/functions/v1/smart-endpoint"

      n8n_workflows:
        - name: "App articles"
          id: "IULapfdKsRAdnEEP"
          webhook: "https://n8n.batiproconcept.fr/webhook/batipro-article-generator"
          description: "Génération article: upload image WP + Gemini AI + création brouillon WP"
        - name: "App articles - Publish"
          id: "OHPfQ9OSX9QEa1g1"
          webhook: "https://n8n.batiproconcept.fr/webhook/batipro-article-publish"
          description: "Publication: met à jour contenu + passe brouillon WP en publié"

      database:
        table: "article_drafts"
        fields:
          - "id (uuid)"
          - "title (text)"
          - "content (text)"
          - "description (text)"
          - "image_url (text)"
          - "wp_media_id (integer)"
          - "wp_post_id (integer)"
          - "wp_post_url (text)"
          - "status (draft/published)"
          - "created_at, updated_at"

    flow:
      1: "Utilisateur upload photo + description"
      2: "App envoie à n8n via Supabase proxy (CORS)"
      3: "n8n: Upload image WordPress + Gemini génère article"
      4: "n8n: Crée brouillon WordPress + retourne données"
      5: "App sauvegarde brouillon dans Supabase"
      6: "Utilisateur édite dans Quill editor"
      7: "Publication: envoie titre/contenu modifiés à n8n"
      8: "n8n: Met à jour WP et publie"

    fixes_applied:
      - "CORS: Supabase Edge Functions comme proxy"
      - "Mobile photo: Retrait capture='environment' pour galerie"
      - "Supabase config: Clé anon ajoutée en fallback"
      - "Bouton loading: CSS display control"
      - "Mobile editor: Quill bubble theme pour sélection tactile"

# Session notes
notes:
  - "Brainstorming déjà complet avec vision claire du produit"
  - "Stack validée: Leaflet + IGN + Supabase + n8n"
  - "Usage: Outil de vente terrain pour commerciaux Bâti Pro"
  - "Module articles: Génération IA + publication WordPress via n8n"
  - "Site WordPress cible: https://www.thibautlab.fr"
  - "Prochaine étape suggérée: document-project ou continuer implémentation"

# Repositories
git:
  repo: "https://github.com/Tarxangel/batipro-web"
  branch: "main"
  last_commit: "c695cc6 - Fix: Mobile text editor - use bubble theme"

# External services
services:
  n8n: "https://n8n.batiproconcept.fr"
  supabase: "https://awhbjbuxbcxszlxcbpjb.supabase.co"
  wordpress: "https://www.thibautlab.fr"
  vercel: "Déploiement automatique depuis GitHub"
